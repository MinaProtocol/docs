import Page from "@reason/pages/Docs";
import DocLink from "@reason/components/DocLink";
export default Page({ title: "Block Producers" });

# Блок-продюсеры

Роль блок-продюсера в Mina заключается в достижении <DocLink copy="консенсуса" url="/architecture/consensus" /> и обеспечении безопасности блокчейна. Блок-продюсер отвечает за создание новых блоков, которые включают в себя недавние транзакции, транслируемые в сети, и блокчейн-доказательство, которое подтверждает, что текущее состояние цепочки является действительным.

В Mina любой может стать блок-продюсером. Существует неограниченное количество участников, у которых есть шанс произвести блок пропорционально средствам в стеке. Средства не блокируются и не подлежат слэшингу.

Взамен на стейкинг средств и генерирование необходимых доказательств блокчейн, блоки, произведенные и включенные в каноническую цепь, вознаграждаются в виде монетной базы и комиссий за транзакции, за вычетом любых комиссий, уплаченных за транзакции для покупки требуемой <DocLink copy="снарк-работы" url="/architecture/snark-workers" />.

Для успешного производства блока, блок-продюсер должен знать текущее состояние блокчейна. Кроме того, они должны иметь достаточно доступных вычислительных возможностей, чтобы произвести SNARK для блокчейна во время слота и быть подключены к пирам, чтобы передать сгенерированный блок с приемлемой задержкой, определяемой параметрами сетевого консенсуса.

### Выбор блок-продюсера

Возможность произвести блок для слота определяется [верифицируемой случайной функцией](https://en.wikipedia.org/wiki/Verifiable_random_function) (VRF). Эту функцию можно рассматривать как лотерею. Каждый блок-продюсер самостоятельно запускает эту VRF для каждого слота, и если они получают результат, превышающий порог, пропорциональный стеку производителя, у них есть шанс произвести блок в назначенном слоте.

Этот процесс является секретным в том смысле, что только владелец закрытого ключа может определить VRF для вывода, и поэтому только он знает, когда он должен произвести блок. Это повышает безопасность, так как злоумышленник не может наметить известного блок-продюсера в определенном месте (например, путем отказа в обслуживании или целенаправленной атаки). В результате чего это также означает, что для одного и того же слота могут быть выбраны несколько производителей. Если несколько блок-продюсеров производят валидный блок для одного и того же слота, это приводит к появлению форка с коротким интервалом, в котором по правилам консенсуса выбирается самая длинная цепочка.

Распределение стека определяется на основе реестра со SNARK на последнем блоке `current epoch-2`, поэтому существует задержка для любого недавно приобретенного или [делегированного стека](#stake-delegation). Например, если текущая эпоха - 10, то распределение стека определяется из снарк-реестра последнего блока 8-ой эпохи.

<Alert>

Просмотреть вывод VRF в логах можно с помощью поиска `Checking VRF evaluations`.

</Alert>

### Создание блока

Когда блок-продюсер выбран для производства блока в слоте, он выполняет следующие действия:

- Выбирает текущий best tip из границы перехода (локальное хранилище блоков), на котором нужно построить новый блок.
- Выбирает транзакции и любую необходимую снарк-работу из соответствующих транзакций- и снарк-пулов. Продюсер блоков должен приобрести снарк-работу в том количестве, которое не будет меньше количества транзакций, которые добавляются в блок. Помимо любых пользовательских транзакций, они также добавляют в качестве вознаграждения за создание блока и любые переводы комиссий, выплачиваемые снарк-работникам.
- Генерирует предлагаемое следующее состояние блокчейна. Это предусматривает создание диффа распределенного реестра, который включает в себя реестр аккаунта, а также scan state (очередь транзакций, которые еще не имеют доказательств). Этот дифф применяется к существующему распределенному реестру для создания нового состояния.
- Создает доказательство блокчейна для подтверждения того, что новое состояние является валидным. Этот SNARK дополнительно подтверждает предыдущее состояние протокола.
- Создает доказательство дельта-перехода цепи, что доказывает действительность блока, если он был получен в пределах допустимой сетевой задержки, определяемой параметрами сетевого консенсуса.
- Применяет данное обновленное состояние локально, добавляя его к существующей границе перехода.
- Передает блок (так называемый "внешний переход") своим пирам.

### Делегирование стека

Делегируемые средства не подлежат расходованию и могут быть в любой момент отозваны путем повторного делегирования стека обратно на исходный аккаунт.

## Удвоенная награда суперчардж

В целях дальнейшего стимулирования стейкинга, блок-продюсер получает двойное вознаграждение, в том случае, если аккаунт, выигравший слот, не имеет никаких <DocLink copy="временно заблокированных токенов" url="/architecture/timelock" />.

Удвоенная награда суперчардж применяется ко всем счетам, как к делегирующим, так и к поддерживающим стейкинг-сервис. Удвоенная награда определяется по аккаунту, выигравшему слот. Например, если незаблокированный счет делегирует стек временно заблокированному счету, и, при этом, выигрывает слот, вознаграждение будет удвоенным. Если же выигрывает временно заблокированный аккаунт, то вознаграждение будет обычным.
