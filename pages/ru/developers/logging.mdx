import Page from "@reason/pages/Docs";
import DocLink from "@reason/components/DocLink";
export default Page({ title: "Daemon Logging" });

# Логгинг

Логи Mina находятся в каталоге конфигурации, расположенном по адресу `~/.mina-config`. Этот каталог содержит следующие лог-файлы:

- `mina.log` - этот файл содержит последние логи daemon. Каждый лог-файл ограничен размером 10 Мебибайт (MiB) и прокручивает более чем 50 лог-файлов. Вращающиеся лог-файлы называются `mina.log.x`, начиная с `mina.log.0` и заканчивая `mina.log.50`.
- `mina-best-tip.log` - этот файл содержит логи лучших подсказок daemon. Этот файл облегчает сбор необходимых логов от нод, чтобы определить лучшее состояние для любого хардфорка. Этот файл ограничен размером 5 Мебибайт (MiB) и прокручивается над одним лог-файлом `mina-best-tip.log.0`.
- `mina-prover.log` - этот файл содержит логи использования памяти prover, а также размеров пакетов. Он ограничен 128 Мебибайтами (МiB) и прокручивается над одним лог-файлом.
- `mina-verifier.log` - этот файл содержит журналы использования памяти верификатора, а также размер пакетов. Он ограничен 128 Мебибайтами (МiB) и прокручивается над одним лог-файлом.

Чтобы следить за логами, используйте одну из следующих команд, в зависимости от того, как вы запустили daemon:

- Докер: `docker logs --follow mina`
- Запуск в качестве службы: `journalctl --user -u mina -n 1000 -f`
- Другое: `tail -f ~/.mina-config/mina.log`

### Уровни логов:

Daemon Мина ведет журнал логов на следующих уровнях, в таком порядке старшинства:

- Spam
- Trace
- Debug
- Info
- Warn
- Error
- Fatal

<Alert>

Указывая `log-level` `Info`, вы получите отображение только сообщений с этого уровня лога и выше, а также значительно уменьшите глаголы логов.

</Alert>

### Форма лога:

Формат логов определяется следующей структурой:

```
{
  "timestamp": timestamp,
  "level": level,
  "source": {
    "module": string,
    "location": string
  },
  "message": format_string,
  "metadata": {{...}}
}
```

Ниже приведен пример сообщения об ошибке:

```
{
  "timestamp": "2020-12-23 21:25:04.616526Z",
  "level": "Error",
  "source": {
    "module": "Transition_router",
    "location": "File \"src/lib/transition_router/transition_router.ml\", line 231, characters 12-24"
  },
  "message": "Failed to find any peers during initialization (crashing because this is not a seed node)",
  "metadata": {
    "host": "1.1.1.2",
    "peer_id": "12D3KooWGQSPgo7ypy9717D3Vgz2RHaqB2ndDRHEFcAfJDAv284q",
    "pid": 12,
    "port": 8302
  }
}
```

### Выгрузка логов:

Mina daemon предоставляет CLI-помощника для сжатия и упаковки доступных лог-файлов от ноды.

При запущенном daemon, запустите `mina client export-logs`, где можно передать дополнительный флаг `-tarfile`, чтобы указать имя файла tar-архива, которое по умолчанию соответствует текущему моменту времени. Эта команда сжимает доступные логи и экспортирует их в каталог `exported_logs` в каталоге `~/.mina-config`.

<Alert>

Логи могут быть экспортированы из работающей ноды через GraphQL с помощью `exportLogs` <DocLink copy="мутации" url="/developers/graphql-api#mutations" />.

</Alert>

Чтобы экспортировать логи из неработающей ноды, запустите команду `mina client export-local-logs`, чтобы сжать доступные локальные лог-файлы. Передайте опцию `tarfile`, чтобы указать имя файла tar-архива, и лог-файлы будут сжаты и экспортированы в каталог `exported_logs` в каталоге `~/.mina-config`.

<Alert>

При создании или обновлении записи о проблеме на GitHub, вы можете загрузить экспортированный файл `tar.gz` прямо в [сообщении] (https://github.com/MinaProtocol/mina/issues).

</Alert>

### Опции записи логов:

Следующие параметры могут быть установлены при запуске daemon для персонализации процесса записи логов:

- `-file-log-level` - уровень лога для лог-файла (по умолчанию: Trace)
- `-log-level` - уровень лога для вывода в терминал через stdout (по умолчанию: Info)
- `-log-json` - распечатать лог-файл в виде JSON (по умолчанию: обычный текст)
- `-log-block-creation` - лог шагов, связанных с включением транзакций и snark-работы в блок (по умолчанию: true)
- `-log-received-blocks` - лог блоков, полученных от пиров (по умолчанию: false)
- `-log-snark-work-gossip` - лог диффов снарк-пула, полученных от пиров (по умолчанию: false)
- `-log-txn-pool-gossip` - лог диффов пула транзакций, полученных от пиров (по умолчанию: false)
- `-log-precomputed-blocks` - включать прекомпилированные блоки в логи (по умолчанию: false)

### Отчеты о сбоях:

Если daemon даёт сбой, будет сгенерирован отчёт о сбое. Будет сохранен только последний отчет о сбое с именем файла, указывающим на время сбоя. Он будет сжат и экспортирован в каталог `~/.mina-config`. Вы можете загрузить этот отчет о сбое в любую из [записей о проблеме GitHub] (https://github.com/MinaProtocol/mina/issues), чтобы определить новые проблемы и содействовать в их устранении.

Отчет о сбое будет содержать некоторые (или все) из следующих лог-файлов:

- `crash_summary.json` - содержит резюме сбоя, включая системную информацию, информацию о версии и окончательный лог-отчет.
- `mina_status.json` - вывод команды `mina client status` для получения информации об окончательном состоянии daemon.
- `mina_short.log` - содержит последние 4MiB файла `mina.log`.
- `registered_mask.dot` - содержит последнюю визуализацию реестра.
- `frontier.dot` - содержит последнюю визуализацию границы.
- `daemon.json` - копия файла конфигурации daemon.
