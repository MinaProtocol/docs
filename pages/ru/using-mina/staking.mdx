import Page from "@reason/pages/Docs";
import DocLink from "@reason/components/DocLink";
export default Page({ title: "Staking & Snarking" });

# Стейкинг и снаркинг

После того, как мы настроили ноду Mina и совершили первую транзакцию, рассмотрим другие способы взаимодействия с сетью Mina, а именно – участие в консенсусе и помощь в сжатии данных с помощью создания zk-SNARK. Управляя своей нодой, которая обеспечивает защиту сети, вы можете получать mina за приложенные усилия.

## Участие в консенсусе

Сеть Mina защищена <DocLink copy="консенсусом Proof-of-Stake" url="/glossary#proof-of-stake" />. Благодаря использованию этой модели консенсуса вам не нужно иметь мощное оборудование, как в случае с майнингом биткоинов. Если у вас есть mina в кошельке, вы можете хранить их в стейкинге или делегировать другой ноде. Давайте сначала посмотрим, как отправлять mina в стейкинг:

<Alert kind="warning">

Чтобы правильно синхронизироваться в сети и участвовать в консенсусе, необходимо запустить на своем сервере форму [протокола для синхронизации часов](https://en.wikipedia.org/wiki/Clock_synchronization). Мы рекомендуем использовать форму [NTP](https://en.wikipedia.org/wiki/Network_Time_Protocol), так как ее легко настроить, и она уже установлена в качестве службы по умолчанию во многих популярных дистрибутивах Linux.

</Alert>

### Стейкинг mina

Для осуществления стейкинга лучше иметь больше средств, но поскольку мы уже выполнили <DocLink copy="предыдущий шаг" url="/using-mina/send-payment#make-a-payment" />, и у нас уже есть средства в кошельке, можно попробовать использовать их для стейкинга mina. Для этого выполните следующую команду:

    mina client set-staking -public-key $MINA_PUBLIC_KEY

В качестве альтернативы вы можете перезапустить daemon с помощью флага `-block-producer-pubkey`:

<DaemonCommandExample args={["-block-producer-pubkey $MINA_PUBLIC_KEY"]} />

Мы всегда можем проверить, в какие аккаунты мы осуществляем стейкинг, используя команду `mina client status`:

```
mina client status

Mina daemon status
-----------------------------------

Global number of accounts:  372
Block height:               20
Max observed block length:  20
Local uptime:               1m48s
Ledger Merkle root:         ...
Protocol state hash:        ...
Staged Hash:                ...
Git SHA-1:                  ...
Configuration directory:    ...
Peers:                      5 (...)
User_commands sent:         0
SNARK worker:               None
SNARK work fee:             1
Sync status:                Synced
Block producers running:    1 (...)
Best tip consensus time:    epoch=0, slot=133
Next proposal:              None this epoch… checking at in 5.284h
Consensus time now:         epoch=0, slot=134
Consensus mechanism:        proof_of_stake
Consensus configuration:    ...
Addresses and ports:        ...
Libp2p PeerID:              ...
```

Поле `Block producers running` в ответе выше возвращает ряд аккаунтов, участвующих в стейкинге в данный момент, с соответствующим ключом.

<Alert kind="warning">

Обратите внимание, если вы самостоятельно отправляете в стейкинг средства с вашего кошелька, вам необходимо всегда быть подключенным к сети для успешного создания блоков. Если вам необходимо часто отключаться от сети, возможно, лучше делегировать свою долю.

</Alert>

Если вы хотите отправить свои монеты на аккаунт, который отличается от аккаунта, используемого для стейкинга, вы можете использовать флаг `-coinbase-receiver` при запуске daemon. Вы можете отправлять свои монеты даже на холодный кошелек!

### Делегирование mina

Делегирование mina – альтернативный вариант размещения в стейкинг напрямую с тем преимуществом, что вам не нужно поддерживать постоянное подключение своей ноды к сети.

Сначала убедитесь, что вы разблокировали свой аккаунт:

    mina account unlock -public-key $MINA_PUBLIC_KEY

Затем запустите эту команду, чтобы делегировать свою долю:

    mina client delegate-stake \
        -receiver <DELEGATE-PUBLIC-KEY> \
        -sender $MINA_PUBLIC_KEY \
        -fee 0.1

Поля в этой команде:

- Флаг `receiver` - публичный ключ получателя делегирования вашего стека
- `sender` – публичный ключ аккаунта, из которого вы хотите делегировать
- `fee` – комиссия за транзакцию для записи вашей транзакции в блокчейне

Вы заметите, что эта команда очень похожа на транзакцию при осуществлении <DocLink copy="платежа" url="/using-mina/send-payment#make-a-payment" />, поскольку делегирование доли – это тоже транзакция! Чтобы изменить эту настройку, нам необходимо заплатить небольшую комиссию за транзакцию.

Делегирование вашего стека может быть полезно, если вы заинтересованы в:

- Запуске собственной стейкинг-ноды, использующей средства из "холодного кошелька"
- Делегировании в "стейкинг-пул", который будет периодически осуществлять выплаты токенов
- Или если у вас недостаточно токенов, чтобы полноценно управлять блок-продюсером

<Alert>

Это латентный период сроком 2–4 недели перед новым делегированием стека.

</Alert>

## Сжатие данных в сети Mina

Протокол Mina уникален тем, что не требует того, чтобы ноды поддерживали полную историю блокчейна, как в других криптопротоколах. Рекурсивно используя криптографические доказательства, протокол Mina эффективно сжимает блокчейн до постоянного размера. Мы называем это сжатием, потому что благодаря этому процессу терабайты данных сокращаются до нескольких килобайт.

Однако это не кодирование или сжатие данных в обычном понимании – можно сказать, ноды "сжимают" данные в сети, генерируя криптографические доказательства. Операторы нод или "снарк-воркеры" играют решающую роль в этом процессе, генерируя zk-SNARK для транзакций, которые были добавлены в блоки.

Вы можете запустить snark-worker, используя следующие команды:

    mina client set-snark-work-fee <FEE>
    mina client set-snark-worker -address $MINA_PUBLIC_KEY

В качестве альтернативы вы можете перезапустить daemon с помощью следующих флагов:

<DaemonCommandExample
  args={["-run-snark-worker $MINA_PUBLIC_KEY", "-snark-worker-fee <fee>"]}
/>

Будучи снарк-воркером, вы можете делиться частью вознаграждения за каждый блок, в который попадают ваши сжатые транзакции. Блок-продюсер ответственен за сбор сжатых транзакций перед включением их в блок, и протокол будет мотивировать блок-продюсера вознаграждать снарк-воркеров.

Снарк-воркеры могут потреблять множество вычислительных ресурсов, поэтому, если вам необходимо ограничить использование CPU, вы можете указать количество потоков, используемых снарк-воркерами, с помощью флага `-snark-worker-parallelism`. Это особенно необходимо, если вы пытаетесь запустить блок-продюсер и снарк-воркер на одной машине, и у вас возникают проблемы со временем, необходимым на производство блоков.

Это касается ролей и обязанностей оператора ноды кода. Поскольку Mina – инклюзивная p2p-сеть, все управляется и запускается децентрализованно нодами по всему миру. Поскольку Mina распределяется инклюзивно, то и присоединиться к Mina может каждый. Код полностью открыт, и нам предстоит выполнить еще множество видов работ, включая технические. Чтобы узнать больше о том, как принять участие в Mina, ознакомьтесь с <DocLink copy="разделом о вкладе в Mina" url="/developers/contributing" />.

### Использование daemon.json для настройки вашего daemon mina

При создании файла в `~/.mina-config/daemon.json` вы можете настроить свой daemon mina и не указывать параметры в командной строке. Это можно использовать для запуска службы mina, а также просто для предотвращения повторяющегося набора текста!

Большинство параметров, которые могут быть переданы `mina daemon` в командной строке, также могут быть параметрами в файле конфигурации. Смотрите `mina daemon -help` для получения дополнительной документации о параметрах. Ниже приведен пример использования всех используемых параметров конфигурации (вам нужно указать в своем файле только те параметры, которые вы хотите изменить):

```
{
  "daemon": {
    "client-port": 1000,
    "external-port": 1001,
    "rest-port": 1002,
    "block-producer-key": "/path/to/privkey-file",
    "block-producer-password": "mypassword",
    "block-producer-pubkey": "<MY PUBLICKEY>",
    "coinbase-receiver": "<MY PUBLICKEY>",
    "log-block-creation": false,
    "log-received-blocks": false,
    "log-snark-work-gossip": false,
    "log-txn-pool-gossip": false,
    "peers": ["seed-one.o1test.net", "seed-two.o1test.net"],
    "run-snark-worker": "<MY PUBLICKEY>",
    "snark-worker-fee": 10,
    "snark-worker-parallelism": 1,
    "work-reassignment-wait": 420000,
    "work-selection": "seq"
  }
}
```
