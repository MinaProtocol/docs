import Page from "@reason/pages/Docs";
import StatusBadge from "@reason/components/StatusBadge";
import DocLink from "@reason/components/DocLink";
export default Page({ title: "Connect to the Network" });

# Подключение к сети

В этом разделе вы узнаете, как подключиться к сети `Mainnet` и совершить первую транзакцию. Сначала необходимо запустить ноду для получения команд.

## Обновление ПО

Необходимо выполнить первый шаг для подключения к `Mainnet` – установить последнюю версию daemon. Выполните следующие действия, согласно инструкциям для вашей операционной системы.

### Ubuntu 18.04 / Debian 9

Сначала удалите любую ранее установленную версию daemon, чтобы избежать ошибок при обновлении до последней версии. Затем вы можете установить последнюю версию следующим образом:

```
sudo apt-get remove -y mina-testnet-postake-medium-curves
echo "deb [trusted=yes] http://packages.o1test.net release main" | sudo tee /etc/apt/sources.list.d/mina.list
sudo apt-get update
sudo apt-get install -y curl unzip mina-mainnet=1.1.8-b10c0e3
```

Запустите `mina version`, чтобы убедиться, что daemon установлен правильно. На выходе должно быть: `Commit b10c0e3db9112a2a8aebc3eec7c6d2570fcc4044 on branch master`.

## Установка ноды

Так как эта технология еще новая, есть риск возникновения исключительных ситуаций при запуске ноды. Мы хотим, чтобы вы знали, если вдруг ваша нода перестанет быть дееспособной. Для этого мы разработали для вас несколько официальных функций автоматической перезагрузки потоков. Мы еще будем говорить об этом в следующих релизах.

Однако перед тем, как пользоваться функцией автоматической перезагрузки, давайте сначала убедимся, что все корректно работает, запустив ноду вручную.

Примечание: Всем, кто пользуется услугами хостинг-провайдера Hetzner: в настоящий момент существует препятствие, поскольку Hetzner считает наше программное обеспечение вредоносным. Перед запуском ноды cмотрите <DocLink copy="Раздел сети на странице устранения неполадок" url="/troubleshooting#networking" />, чтобы понять, как исправить ситуацию.

Выполните следующую команду, чтобы запустить экземпляр ноды Mina и подключиться к действующей сети:

```
mina daemon --generate-genesis-proof true --peer-list-url https://storage.googleapis.com/mina-seed-lists/mainnet_seeds.txt
```

Аргумент `-peer-list`, указанный выше, относится к адресу сид-пира - это начальный пир, который мы подключаем в сети. Поскольку Mina – <DocLink copy="p2p" url="/glossary#peer-to-peer" /> -протокол, не существует единого централизованного сервера, на который мы могли бы полагаться.

Узнайте <DocLink copy="тут" url="/troubleshooting" /> об общих проблемах, возникающих при первом запуске ноды.

Установка еще не завершена! После того, как вы подтвердили, что все корректно работает, запустив автономный процесс, важно, чтобы мы запустили Mina таким образом, чтобы поток автоматически перезапускался при возникновении проблемы.

Убейте существующий процесс `mina daemon`, нажав `Ctrl-C`, и читайте дальше:

### Ubuntu 18.04 / Debian 9

Убедитесь, что ваш закрытый ключ, с помощью которого вы зарегистрировались, находится в `~/keys/my-wallet`.

Добавьте файл `~/.mina-env`, содержащий следующее:

```
CODA_PRIVKEY_PASS="private key password"
EXTRA_FLAGS=" --file-log-level Debug"
```

Позже, если необходимо, вы cможете добавить дополнительные флаги в `EXTRA_FLAGS`.

Затем выполните следующие команды, чтобы запустить экземпляр ноды Mina и подключиться к действующей сети:

```
systemctl --user daemon-reload
systemctl --user start mina
systemctl --user enable mina
sudo loginctl enable-linger
```

Эти команды позволят ноде продолжить работу после выхода из системы и автоматически перезапуститься при перезагрузке машины.

По умолчанию нода подключается к сети, используя внешний порт 8302. Это можно изменить с помощью флага `-external-port`, просто добавив его в EXTRA_FLAGS.

Вы также можете изучить сам процесс mina, который работает в фоновом режиме и перезапускается автоматически.

С помощью этой команды вы узнаете, сталкивалась ли `mina` с проблемами в начале работы.

```
systemctl --user status mina
```

Вы можете корректно остановить mina и прекратить автоматическую перезагрузку службы:

```
systemctl --user stop mina
```

Выполните перезагрузку вручную:

```
systemctl --user restart mina
```

И посмотрите на логи:

```
journalctl --user -u mina -n 1000 -f
```

В некоторых случаях для просмотра логов необходимо вместо этой команды выполнить следующую:

```
journalctl --user-unit mina -n 1000 -f
```

Эта команда покажет вам последние 1000 строк и начнется оттуда.

### Docker

Если вы запускаете daemon с помощью Docker, сначала убедитесь, что у вашего закрытого ключа правильные разрешения.

```
cd ~
chmod 700 ~/keys
chmod 600 ~/keys/my-wallet
mkdir ~/.mina-config
```

Теперь просто запустите образ с вашими ключами и установленным ~/.mina-config:

```
docker run --name mina -d \
-p 8302:8302 \
--restart=always \
--mount "type=bind,source=`pwd`/keys,dst=/keys,readonly" \
--mount "type=bind,source=`pwd`/.mina-config,dst=/root/.mina-config" \
-e CODA_PRIVKEY_PASS="YOUR PASSWORD HERE" \
gcr.io/o1labs-192920/mina-daemon-baked:1.1.8-b10c0e3-mainnet \
daemon \
--block-producer-key /keys/my-wallet \
--insecure-rest-server \
--file-log-level Debug \
--log-level Info \
--peer-list-url https://storage.googleapis.com/mina-seed-lists/mainnet_seeds.txt
```

Запустите `docker logs -f mina`, чтобы отслеживать логи, а в случае сбоя сохраните вывод лога в файл с `docker logs mina > mina-log.txt` и опубликуйте вывод в канал #mentor-nodes или прикрепите полный файл ~/.mina-config/mina.log в GitHub issues и отправьте проблему на рассмотрение в discord.

Запустите `docker exec -it mina mina client status`, чтобы контролировать соединение с сетью, вам необходимо быстро найти как минимум 10 пиров и наблюдать за увеличением высоты блока / максимальной допустимой высотой блока.

## Проверка соединения

После того, как мы запустили ноду и daemon Mina, откройте другую оболочку и выполните следующую команду:

    mina client status

<Alert>

Подключение `mina client status` к daemon может занять до минуты при первом запуске. Поэтому если вы видите `Error: daemon not running. See mina daemon`, подождите немного и попробуйте еще раз.

Если вы используете <DocLink copy="here" url="/developers/sandbox-node" />, вам нужно будет запустить `mina client status` внутри самого контейнера из-за способа взаимодейсвия с командой клиентского статуса mina:

`docker exec -it mina bash`

</Alert>

Скорее всего, мы увидим ответ, который будет включать следующие поля:

    ...
    Peers:                                         Total: 4 (...)
    ...
    Sync Status:                                   Bootstrap

Если вы видите `Sync Status: Bootstrap`, это означает, что нода загружается и должна синхронизироваться с остальной частью сети. Наберитесь терпения, так как выполнение этого шага может занять некоторое время для того, чтобы нода получила все необходимые данные.

Через некоторое время ваша нода должна подключиться к большему количеству пиров, а затем – перейти в состояние `Sync Status: Catchup`, означающее, что мы собираем самые последние блоки и состояние, пытаясь догнать самый высокий блок.

Когда появляется статус синхронизации `Synced`, и нода подключена к 1 или более пирам, это значит, мы успешно подключились к сети. После синхронизации мы также видим соответствующий лог daemon: `[Info] Mina daemon is now synced`.

Если состояние `Bootstrap` сохраняется более часа, возможно, возникла проблема с конфигурацией вашего порта.

## Импорт вашего аккаунта

После синхронизации нашей ноды нам необходимо импортировать наш публичный/приватный keypair, чтобы мы могли подписывать транзакции и генерировать адрес для приема платежей. Из соображений безопасности мы хотим поместить ключи в каталог, к которому злоумышленникам сложнее получить доступ.

Запустите следующую команду, чтобы импортировать <DocLink copy="ранее сгенерированный" url="/using-mina/keypair" /> файл keypair:

    mina accounts import -privkey-path ~/keys/my-wallet

Вам будет предложено ввести пароль, который вы указали при создании аккаунта.

<Alert kind="warning">

Вы можете делиться публичным ключом с кем угодно, однако будьте очень осторожны при использовании файла с приватным ключом. Никогда и ни с кем не делитесь этим приватным ключом, так как он является аналогом пароля доступа к вашим средствам.

</Alert>

Ответ этой команды будет выглядеть следующим образом:

    😄 Imported account!
    Public key: B62qjaA4N9843FKM5FZk1HmeuDiojG42cbCDyZeUDQVjycULte9PFkC

В дополнение, вы можете использовать команду `mina accounts create` для создания нового аккаунта и возможности отправлять и получать транзакции.

<Alert kind="warning">

Если вы входите в список выбранных тестнет-участников, которые получили делегацию стека, пожалуйста, выполняйте задания, используя созданный ранее аккаунт. Вам не нужно создавать новый аккаунт!

Если вы создадите новый аккаунт и будете использовать его для выполнения заданий, мы не сможем отслеживать начисление баллов за вашу активность.

</Alert>

Поскольку публичный ключ довольно длинный, и его трудно запомнить, давайте сохраним его как переменную среды. Используйте следующую команду, но замените `<YOUR-PUBLIC-KEY>` на вывод открытого ключа из предыдущей команды:

    export MINA_PUBLIC_KEY=<YOUR-PUBLIC-KEY>

Теперь доступ к нему всегда будет `$ MINA_PUBLIC_KEY` – проверьте, правильно ли вы его сохранили, используя` echo $ MINA_PUBLIC_KEY`.

Обратите внимание, что эти переменные среды сохраняются только для текущего сеанса оболочки, поэтому, если вы хотите сохранить их для дальнейшего использования, вы можете добавить их в `~/.profile` или `~/.bash_profile`.

<Alert>

Если вы запускаете ноду на облачной виртуальной машине, обязательно экспортируйте и сохраните файл ключа. Вы можете экспортировать ключ с помощью:

    mina accounts export -public-key <PUBLIC-KEY> -privkey-path <EXPORT-PATH>

Затем сохраните его на своем локальном компьютере, можете использовать [scp](https://linux.die.net/man/1/scp):

    scp <EXPORT-PATH> <LOCAL-DESTINATION>

Позже при запуске новой виртуальной машины вы можете загрузить ключ, а затем импортировать его:

    mina accounts import -privkey-path <PRIVATE-KEY-FILE>

</Alert>

Если вы вдруг забудете, какие пары ключей уже создали, вы сможете увидеть их все с помощью:

    mina accounts list

## Проверка баланса аккаунта

Для появления ваших средств может потребоваться несколько минут. Мы можем проверить баланс на всех наших аккаунтах с помощью этой команды:

    mina accounts list

В своем аккаунте вы можете увидеть `Balance: 0 mina`. В зависимости от трафика в сети может потребоваться несколько блоков, чтобы ваша транзакция прошла.

<em>Подсказка</em>: Можете запустить `mina client status` чтобы увидеть текущее
обновление высоты блока.

## Совершение платежа

Наконец, мы со всем справились и делаем нашу первую транзакцию! Перед отправкой платежа вам необходимо разблокировать свой аккаунт:

    mina accounts unlock -public-key $MINA_PUBLIC_KEY

С целью тестирования уже настроена эхо-служба, которая сразу же вернет вам платеж за вычетом комиссии за транзакцию. Вы можете использовать следующий публичный ключ для эхо-бота.

```
B62qndJi5mnRoBZ8SAYDM1oR2SgAk5WpZC8hGpJUZ4e64kDHGbFMeLJ
```

<Alert kind="warning">
    
Существует известная проблема с эхо-службой, которая может помешать ей должным образом отозвать ваш платеж! Не волнуйтесь, вы все-равно получите свои тестнет-баллы[\*](#disclaimer) за выполнение заданий.

Эхо-статус: <StatusBadge service="Echo Bot" />

</Alert>

Давайте отправим в этот сервис несколько mina, которые мы недавно получили, чтобы увидеть, как выглядит платеж:

    mina client send-payment \
      -amount 0.5 \
      -receiver B62qndJi5mnRoBZ8SAYDM1oR2SgAk5WpZC8hGpJUZ4e64kDHGbFMeLJ \
      -fee 0.1 \
      -sender $MINA_PUBLIC_KEY

Если интересно, вот что мы передали верхним командам:

- Для параметра `amount`мы отправляем тестовое значение `0.5` mina
- `receiver` – это публичный ключ [эхо-сервиса](https://github.com/MinaProtocol/mina-automation/tree/master/services/echo)
- Для параметра `fee` используем 0.1 mina
- `sender` – это полноценный публичный ключ, т.е., `B62qjaA4N9843FKM5FZk...`

Если эта команда отформатирована правильно, мы должны получить ответ, который выглядит следующим образом:

    Dispatched payment with ID 3XCgvAHLAqz9VVbU7an7f2L5ffJtZoFega7jZpVJrPCYA4j5HEmUAx51BCeMc232eBWVz6q9t62Kp2cNvQZoNCSGqJ1rrJpXFqMN6NQe7x987sAC2Sd6wu9Vbs9xSr8g1AkjJoB65v3suPsaCcvvCjyUvUs8c3eVRucH4doa2onGj41pjxT53y5ZkmGaPmPnpWzdJt4YJBnDRW1GcJeyqj61GKWcvvrV6KcGD25VEeHQBfhGppZc7ewVwi3vcUQR7QFFs15bMwA4oZDEfzSbnr1ECoiZGy61m5LX7afwFaviyUwjphtrzoPbQ2QAZ2w2ypnVUrcJ9oUT4y4dvDJ5vkUDazRdGxjAA6Cz86bJqqgfMHdMFqpkmLxCdLbj2Nq3Ar2VpPVvfn2kdKoxwmAGqWCiVhqYbTvHkyZSc4n3siGTEpTGAK9usPnBnqLi53Z2bPPaJ3PuZTMgmdZYrRv4UPxztRtmyBz2HdQSnH8vbxurLkyxK6yEwS23JSZWToccM83sx2hAAABNynBVuxagL8aNZF99k3LKX6E581uSVSw5DAJ2S198DvZHXD53QvjcDGpvB9jYUpofkk1aPvtW7QZkcofBYruePM7kCHjKvbDXSw2CV5brHVv5ZBV9DuUcuFHfcYAA2TVuDtFeNLBjxDumiBASgaLvcdzGiFvSqqnzmS9MBXxYybQcmmz1WuKZHjgqph99XVEapwTsYfZGi1T8ApahcWc5EX9
    Receipt chain hash is now A3gpLyBJGvcpMXny2DsHjvE5GaNFn2bbpLLQqTCHuY3Nd7sqy8vDbM6qHTwHt8tcfqqBkd36LuV4CC6hVH6YsmRqRp4Lzx77WnN9gnRX7ceeXdCQUVB7B2uMo3oCYxfdpU5Q2f2KzJQ46

Вы можете не увидеть `Receipt chain hash` первой транзакции из аккаунта, но при следующих транзакциях вы увидите заголовок списка хэшей цепочки получателя.

Как только вы научитесь создавать адрес, а также отправлять и получать mina, можно переходить к изучению следующих интересных возможностей сети Mina, таких как <DocLink copy="участие в консенсусе и помощь в сжатии блокчейна" url="/advanced/bp-sidecar" />.

## Переход на следующий этап

Теперь, когда у вас получилось полностью синхронизировать ноду, мы можем рассказать о других более продвинутых функциях daemon в разделе <DocLink copy="Стейкинг & Делегирование" url="/using-mina/staking" />. А если вы хотите заработать больше токенов, ознакомьтесь с программой <DocLink copy="Foundation Delegation Program" url="/advanced/foundation-delegation-program" />.

<span id="disclaimer">

\*\*\*\*Тестнет-баллы предназначены исключительно для отслеживания вклада в развитие тестовой сети, и тестнет-баллы не имеют денежной или иной монетарной ценности. Тестнет-баллы не подлежат передаче, приобретению или обмену на криптовалюту или цифровые активы. Мы можем в любое время изменить или прекратить программу тестнет-баллов.\_

</span>
