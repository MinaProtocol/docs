import Page from "@reason/pages/Docs";
import DocLink from "@reason/components/DocLink";
export default Page({ title: "Lifecycle of a Payment" });

# Жизненный цикл транзакций

Чтобы транзакции в сети Mina считались верифицированными и завершенными, они должны пройти несколько этапов.Этот документ был создан с целью дать упрощенный взгляд на обработку одного платежа, и помочь разобраться в том как Mina проводит платежи. Это не исчерпывающий технический обзор, а упрощенное руководство для пользователей. Чтобы получить более подробный технический обзор, ориентированный на разработчиков, желающих разобраться в кодовой базе, ознакомьтесь с <DocLink copy="техническим жизненным циклом транзакций" url="/architecture/lifecycle-payment-technical" />.

!!! Примечание
Чтобы гарантировать своевременную и надежную передачу сообщения стальным членам сети, Mina использует протокол сплетен.

## Платежи

Платеж - это вид транзакции, которая запрашивает перевод средств с одной учетной записи на другую, как и соответствующая комиссия, которую отправитель готов заплатить за проведение платежа.

Давайте рассмотрим ситуацию, в которой отправитель по имени Боб хочет отправить получателю Алисе некоторую сумму.

### Шаг 1. Создание платежа - Боб нажимает ‘отправить’

Любой участник сети может создать платеж и поделиться им с сетью Mina. Платеж криптографически подписывается закрытым ключом для верификации учетной записи отправителя. Затем он отправляется на на обработку другим пирам в сети. Платеж, полученный пиром, будет храниться в его локальном `пуле транзакций`, представляющий собой хранилище в памяти всех транзакций, о которых пир слышал в сети.

### Шаг 2. Создание блока - платеж Боба вносится в список задач

В сети отбирается блок-продюсер для данного временного интервала. Текущий активный продюсер выбирает промежуточные транзакции основываясь на комисси и помещает их в список для обработки, называемый переходным блоком. За построение этих блоков блок-продюсеры зарабатывают мину. Продюсер генерирует SNARK, определяющий структуру переходного блока в сравнении с предыдущим блоком (но еще не проверяя эти новые платежи). Продюсер передает эту новую информацию снарк-воркерам для обработки.

### Шаг 3. Снарк подтверждение транзакции - Боб подписывает снарк-платеж

В сети снарк-воркеры приступают к снарк-вычислениям на каждой ступени нового переходного блока. Эти вычисления - индивидуальное доказательство каждого платежа, которые затем объединяются с доказательствами соседних платежей. В итоге все платежи проходят верификацию. Генерируя эти доказательства, снарк-воркеры могут зарабатывать валюту, которую блок-продюсер выплачивает из своих вознаграждений за блоки. Эти доказательства передаются по сети.

### Шаг 4. Подтверждение платежа - Результат транзакции отображается в аккаунтах Алисы и Боба

После получения доказательства всего блока, блок-продюсер отправит подтверждение блока перехода. Затем ноды в сети применяют изменения к балансам своих локальных счетов, чтобы отразить эти изменения.

### Шаг 5: Уровень достоверности платежа - Алиса уверена, что перевод завершен

С каждым последующим блоком получатель имеет все больше оснований быть уверенным в успешности транзакции, и в том, что у сети есть консенсус по поводу этого блока. Однако, как и в большинстве блокчейнов, платеж считается подтвержденными после создания определенного количества блоков, что также известно как финализация транзакции.

В сети Биткойн транзакция подтверждается после [6 блоков](https://en.bitcoin.it/wiki/Confirmation) (60 минут) предполагая, что злоумышленник вряд ли накопит более 10% хешрейта.

Допустим что длительность слота 3 минуты и честность стека равна 90%. Следующая таблица демонстрирует финализацию в блоках, среднее время, необходимое для создания соответствующего количества блоков, и гарантию того, что платеж будет подтвержден.

| Финализация (в блоках) | Среднее время финализации | Гарантия финализации (%) |
| ---------------------- | ------------------------- | ------------------------ |
| 8                      | 33 мин                    | 98.6709                  |
| 15                     | 60 мин                    | 99.9231                  |
| 23                     | 1ч 32мин                  | 99.9965                  |
| 30                     | 2ч                        | 99.9998                  |
| 38                     | 2ч 32мин                  | 100                      |

Расчет среднего времени основывается на консенсусных константах, которые определяют количество заполняемых слотов за эпоху. На данный момент это количество равно 75%.

Рекомендуемое время ожидания для подтверждения транзакции составляет 15 блоков, что дает 99,9% гарантию того, что транзакция не будет отклонена.

## Сценарии неудач

### Сеть отклонила транзакцию

Есть несколько причин, из-за которых транзакция, в которой участвуют другие пиры, может быть отклонена:

- Транзакция принципиально недействительна. Это означает, что учетная запись отправителя не существует, в ней недостаточно средств, подпись не совпадает с учетной записью или временный номер в транзакции не был увеличен.
- В сети могут находиться враждебные ноды. Они действуют сообща, чтобы помешать определенному отправителю воспользоваться сервисом. Однако такое поведение активно подавляется. Для решения такой проблемы достаточно одной честной ноды.

### Транзакция не включена в блок

Если транзакция валидна, а сеть честна, тогда транзакция имеет все основания попасть в блок. Однако есть одно условие, при котором транзакция может быть исключена из пула транзакций:

- Если пул транзакций достигает максимальной заполненности или `max_txpool_size`, он вытесняет из пула транзакцию с самой низкой комиссией, в следствии чего она выгружается из памяти. В таком случае, отправителю придется отправить транзакцию повторно, но уже с более высокой комиссией в соответствии с динамикой рынка в определенный период времени.
